<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jobs</title>
  <style>
    .job-item {
      border: 1px solid #ddd;
      margin-bottom: 1rem;
      padding: 1rem;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <h1>Job Listings</h1>
  <div id="job-list"></div>

  <h2>Add a New Job</h2>
  <form id="job-form">
    <input type="text" name="familyName" placeholder="Family Name" required><br>
    <input type="text" name="contactNumber" placeholder="Contact Number" required><br>
    <input type="email" name="email" placeholder="Email" required><br>
    <input type="text" name="jobTitle" placeholder="Job Title" required><br>
    <textarea name="jobDescription" placeholder="Job Description" required></textarea><br>
    <input type="text" name="jobLocation" placeholder="Job Location" required><br>
    <input type="text" name="schedule" placeholder="Preferred Schedule"><br>
    <input type="number" name="payment" placeholder="Payment (Birr)" required><br>
    <textarea name="additionalInfo" placeholder="Additional Information"></textarea><br>
    <button type="submit">Add Job</button>
  </form>

  <script>
    async function fetchJobs() {
      try {
        const response = await fetch('/jobs');
        if (!response.ok) throw new Error(`Error: ${response.statusText}`);
        const jobs = await response.json();

        const jobList = document.getElementById('job-list');
        jobList.innerHTML = '';
        if (jobs.length === 0) {
          jobList.innerHTML = '<p>No job listings available.</p>';
          return;
        }

        jobs.forEach(job => {
          const jobItem = document.createElement('div');
          jobItem.className = 'job-item';
          jobItem.innerHTML = `
            <h3>${job['Job Title'] || 'Unknown Job Title'}</h3>
            <p><strong>Location:</strong> ${job['Job Location'] || 'Unknown'}</p>
            <p><strong>Description:</strong> ${job['Job Description'] || 'No description available.'}</p>
            <p><strong>Contact:</strong> ${job['Contact Number'] || 'N/A'}, ${job.Email || 'N/A'}</p>
            <p><strong>Payment:</strong> ${job.Payment || 'Not specified'}</p>
            <p><strong>Additional Info:</strong> ${job['Additional Information'] || 'None'}</p>
          `;
          jobList.appendChild(jobItem);
        });
      } catch (error) {
        console.error('Failed to fetch jobs:', error);
        alert('Failed to fetch job listings. Please try again later.');
      }
    }

    document.getElementById('job-form').addEventListener('submit', async (event) => {
      event.preventDefault();
      const formData = new FormData(event.target);
      const data = Object.fromEntries(formData.entries());

      try {
        const response = await fetch('/jobs', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        if (!response.ok) throw new Error('Failed to add job');
        alert('Job added successfully!');
        event.target.reset();
        fetchJobs(); // Refresh job listings
      } catch (error) {
        console.error('Failed to add job:', error);
        alert('Failed to add job. Please try again later.');
      }
    });

    fetchJobs();
  </script>
</body>
</html>
